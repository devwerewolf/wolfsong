<!DOCTYPE html>
<html>
  <head>
    <style>
      body { font-family: system-ui; padding: 10px; background: #fff5f5; font-size: 14px; }
      button { padding: 6px 12px; margin: 3px; cursor: pointer; font-size: 12px; }
    </style>
  </head>
  <body>
    <h3>Nested Iframe</h3>
    <p>Count: <span id="count-display">0</span></p>
    <button id="reset-btn">Reset to 0</button>
    
    <script src="../lib/client-inline.js"></script>
    <script>
      // This simulates the app having "imported" the library (nested app)
      
      // Initialize client - nested iframe receives state via parent iframe
      const client = createChildClient([
        { key: 'count' }
      ], { debug: true });
      
      // Subscribe to count changes
      client.subscribeToAtom('count', (value) => {
        document.getElementById('count-display').textContent = value;
      });
      
      // Reset button - sends to top window
      document.getElementById('reset-btn').addEventListener('click', () => {
        // For nested iframes, we need to send to top
        window.top.postMessage({
          type: 'atom-sync',
          key: 'count',
          value: 0,
          timestamp: Date.now()
        }, '*');
      });
    </script>
  </body>
</html>
